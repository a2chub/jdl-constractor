# JDL IDマスター連携仕様書

## 1. 概要

### 1.1 目的
- JDL IDマスターデータとの連携による選手情報の検証
- 出場歴情報の確認
- クラス情報の同期
- データの整合性確保

### 1.2 連携の範囲
1. 選手情報
   - JDL ID
   - 選手名
   - 出場歴
   - 所属クラス

2. 大会情報
   - ラウンド情報
   - クラス情報
   - 出場記録

## 2. データ連携仕様

### 2.1 データ形式
1. CSVファイル形式
   - 文字コード：UTF-8
   - 改行コード：LF
   - 区切り文字：カンマ(,)

2. ファイル構成
   - 選手マスター（players.csv）
   - 出場歴データ（history.csv）
   - クラス情報（classes.csv）

### 2.2 更新タイミング
1. 選手情報
   - 提供頻度：日次
   - 更新タイミング：毎日0時

2. 大会情報
   - 提供頻度：大会終了後
   - 更新タイミング：データ提供後即時

## 3. データ検証

### 3.1 選手情報検証
1. JDL ID検証
   - 形式チェック
   - 存在チェック
   - 有効性チェック

2. 出場歴検証
   - 回数カウント
   - 有効な出場のみカウント
   - 4回以上の判定

### 3.2 クラス情報検証
1. クラスの判定
   - 現在の所属クラス確認
   - クラス変更履歴の確認
   - ラウンドごとのクラス情報管理

## 4. エラー処理

### 4.1 データ不整合時の対応
1. エラーパターン
   - JDL ID不一致
   - データ欠損
   - 形式不正

2. エラー通知
   - 管理者への通知
   - エラーログの記録
   - エラー内容の詳細記録

### 4.2 リカバリ処理
1. 自動リカバリ
   - 一時的なエラーの再試行
   - バックアップデータの利用

2. 手動リカバリ
   - 管理者による確認
   - データの手動修正
   - 更新の再実行

## 5. セキュリティ

### 5.1 データ保護
1. ファイル転送時の暗号化
   - TLS 1.3の使用
   - 強固な暗号化方式の採用

2. アクセス制御
   - 接続元IPの制限
   - アクセス権限の管理

### 5.2 監査ログ
1. ログ記録
   - データ更新履歴
   - エラー履歴
   - アクセス履歴

2. ログ保管
   - 保管期間：1年
   - 暗号化保存
   - アクセス制御 